name: Restart job
run-name: job ${{ github.event.inputs.deployment_name }} by @${{ github.actor }}

on:
  # Ability to execute on demand
  workflow_dispatch:
    inputs:
      deployment_name:
        type: string
        description: |
          Name with letters, numbers, hyphens; start with a letter. Max 20 chars. e.g., 'my-env-123'
        required: true
jobs:
  init:
    runs-on: ubuntu-20.04
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Fail Job
        run: exit 1
  rerun-failed-jobs:
    runs-on: ubuntu-latest
    needs: [init]
    if: failure()
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4
      - name: Rerun failed jobs in the current workflow
        env:
          GH_TOKEN: ${{ github.token }}
        run: gh run rerun ${{ github.run_id }} --failed
